---
stages:

  - cluster setup
  - Infra setup
  - Application Setup
  - experiment
  - e2e-metrics
  - Application Cleanup
  - Infra cleanup
  - cluster cleanup

Cluster Connect:
  image: litmuschaos/litmus-openebs-tests:latest
  stage: cluster setup
  tags:
    - litmus-openebs
  script:
    - chmod 755 ./build/gitlab/stages/3-cluster-connect/cluster-connect
    - ./build/gitlab/stages/3-cluster-connect/cluster-connect
  artifacts:
    when: always
    paths:
      - .kube/

Build Litmus:
  when: always
  image: litmuschaos/litmus-openebs-tests:latest
  stage: Infra setup
  tags:
    - litmus-openebs
  script:
    - make build-litmus
  artifacts:
    when: always
    paths:
      - .kube/

  
Build OpenEBS:
  when: always
  image: litmuschaos/litmus-openebs-tests:latest
  stage: Infra setup
  tags:
    - litmus-openebs
  script:
    - make build-openebs
  artifacts:
    when: always
    paths:
      - .kube/

App Deploy:
  when: always
  image: litmuschaos/litmus-openebs-tests:latest
  stage: Application Setup
  tags:
    - litmus-openebs
  script:
    - make app-deploy
  artifacts:
    when: always
    paths:
      - .kube/

TCID-VMWx-OPENEBS-APP-OPENEBS-TARGET-POD-FAILURE:
  when: always
  image: litmuschaos/litmus-openebs-tests:latest
  stage: experiment
  tags:
    - litmus-openebs
  script:
    - make openebs-target-pod-failure
  artifacts:
    when: always
    paths:
      - .kube/

TCID-VMWx-OPENEBS-APP-OPENEBS-POOL-CONTAINER-FAILURE:
  when: always
  image: litmuschaos/litmus-openebs-tests:latest
  stage: experiment
  tags:
    - litmus-openebs
  script:
    - make openebs-pool-container-failure
  artifacts:
    when: always
    paths:
      - .kube/

TCID-VMWx-OPENEBS-APP-OPENEBS-POOL-POD-FAILURE:
  when: always
  image: litmuschaos/litmus-openebs-tests:latest
  stage: experiment
  tags:
    - litmus-openebs
  script:
    - make openebs-pool-pod-failure
  artifacts:
    when: always
    paths:
      - .kube/

TCID-VMWx-OPENEBS-APP-OPENEBS-TARGET-CONTAINER-FAILURE:
  when: always
  image: litmuschaos/litmus-openebs-tests:latest
  stage: experiment
  tags:
    - litmus-openebs
  script:
    - make openebs-target-container-failure
  artifacts:
    when: always
    paths:
      - .kube/

TCID-VMWx-OPENEBS-APP-OPENEBS-TARGET-NETWORK-DELAY:
  when: always
  image: litmuschaos/litmus-openebs-tests:latest  
  stage: experiment
  tags:
    - litmus-openebs
  script:
    - make openebs-target-network-delay
  artifacts:
    when: always
    paths:
      - .kube/

TCID-VMWx-OPENEBS-APP-OPENEBS-TARGET-NETWORK-LOSS:
  when: always
  image: litmuschaos/litmus-openebs-tests:latest
  stage: experiment
  tags:
    - litmus-openebs
  script:
    - make openebs-target-network-loss
  artifacts:
    when: always
    paths:
      - .kube/

TCID-VMWx-OPENEBS-APP-OPENEBS-CONTROL-PLANE-CHAOS:
  when: always
  image: litmuschaos/litmus-openebs-tests:latest
  stage: experiment
  tags:
    - litmus-openebs
  script:
    - make openebs-control-plane-chaos
  artifacts:
    when: always
    paths:
      - .kube/

e2e-metric:
  when: always
  image: litmuschaos/litmus-openebs-tests:latest
  stage: e2e-metrics
  tags:
    - litmus-build
  script:
    - make e2e-metrics
  artifacts:
    when: always
    paths:
      - .kube/

Application Cleanup:
  when: always
  image: litmuschaos/litmus-openebs-tests:latest
  stage: Application Cleanup
  tags:
    - litmus-openebs
  script:
    - make app-cleanup
  artifacts:
    when: always
    paths:
      - .kube/

Litmus Cleanup:
  when: always
  image: litmuschaos/litmus-openebs-tests:latest
  stage: Infra cleanup
  tags:
    - litmus-openebs
  script:
    - make litmus-cleanup
  artifacts:
    when: always
    paths:
      - .kube/
    

OpenEBS Cleanup:
  when: always
  image: litmuschaos/litmus-openebs-tests:latest
  stage: Infra cleanup
  tags:
    - litmus-openebs
  script:
    - make openebs-cleanup
  artifacts:
    when: always
    paths:
      - .kube/

Pipeline Status Check:
  when: always
  image: litmuschaos/litmus-openebs-tests:latest
  stage: Infra cleanup
  tags:
    - litmus-build
  script:
    - make pipeline-status-update
  artifacts:
    when: always
    paths:
      - .kube/

Cluster Disconnect:
  when: always
  image: litmuschaos/litmus-openebs-tests:latest
  stage: cluster cleanup
  tags:
    - litmus-openebs
  script: 
    - chmod 755 ./build/gitlab/stages/4-cluster-disconnect/cluster-disconnect
    - ./build/gitlab/stages/4-cluster-disconnect/cluster-disconnect
  artifacts:
    when: always
    paths:
      - .kube/

