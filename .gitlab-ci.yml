---
stages:

  - cluster setup
  - Infra setup
  - Application Setup
  - experiment
  - Application Cleanup
  - Infra cleanup
  - cluster cleanup

Cluster Connect:
  stage: cluster setup
  tags:
    - litmus-openebs
  script: 
    - chmod 755 ./build/gitlab/stages/3-cluster-connect/cluster-connect
    - ./build/gitlab/stages/3-cluster-connect/cluster-connect
  artifacts:
    when: always
    paths:
      - .kube/

Build Litmus:
  when: always
  stage: Infra setup
  tags:
    - litmus-openebs
  script:
    - make build-litmus
  artifacts:
    when: always
    paths:
      - .kube/

  
Build OpenEBS:
  when: always
  stage: Infra setup
  tags:
    - litmus-openebs
  script:
    - make build-openebs
  artifacts:
    when: always
    paths:
      - .kube/

App Deploy:
  when: always
  stage: Application Setup
  tags:
    - litmus-openebs
  script:
    - make app-deploy
  artifacts:
    when: always
    paths:
      - .kube/

OpenEBS Target Pod Failure:
  when: always
  stage: experiment
  tags:
    - litmus-openebs
  script:
    - make openebs-target-pod-failure
  artifacts:
    when: always
    paths:
      - .kube/

OpenEBS Pool Container Failure:
  when: always
  stage: experiment
  tags:
    - litmus-openebs
  script:
    - make openebs-pool-container-failure
  artifacts:
    when: always
    paths:
      - .kube/

OpenEBS Pool Pod Failure:
  when: always
  stage: experiment
  tags:
    - litmus-openebs
  script:
    - make openebs-pool-pod-failure
  artifacts:
    when: always
    paths:
      - .kube/

OpenEBS Target Container Failure:
  when: always
  stage: experiment
  tags:
    - litmus-openebs
  script:
    - make openebs-target-container-failure
  artifacts:
    when: always
    paths:
      - .kube/

OpenEBS Target Network Delay:
  when: always
  stage: experiment
  tags:
    - litmus-openebs
  script:
    - make openebs-target-network-delay
  artifacts:
    when: always
    paths:
      - .kube/

OpenEBS Target Network Loss:
  when: always
  stage: experiment
  tags:
    - litmus-openebs
  script:
    - make openebs-target-network-loss
  artifacts:
    when: always
    paths:
      - .kube/

OpenEBS Control Plane Chaos:
  when: always
  stage: experiment
  tags:
    - litmus-openebs
  script:
    - make openebs-control-plane-chaos
  artifacts:
    when: always
    paths:
      - .kube/

Application Cleanup:
  when: always
  stage: Application Cleanup
  tags:
    - litmus-openebs
  script:
    - make app-cleanup
  artifacts:
    when: always
    paths:
      - .kube/

Litmus Cleanup:
  when: always
  stage: Infra cleanup
  tags:
    - litmus-openebs
  script:
    - make litmus-cleanup
  artifacts:
    when: always
    paths:
      - .kube/
    

OpenEBS Cleanup:
  when: always
  stage: Infra cleanup
  tags:
    - litmus-openebs
  script:
    - make openebs-cleanup
  artifacts:
    when: always
    paths:
      - .kube/

Cluster Disconnect:
  when: always
  stage: cluster cleanup
  tags:
    - litmus-openebs
  script: 
    - chmod 755 ./build/gitlab/stages/4-cluster-disconnect/cluster-disconnect
    - ./build/gitlab/stages/4-cluster-disconnect/cluster-disconnect
  artifacts:
    when: always
    paths:
      - .kube/

